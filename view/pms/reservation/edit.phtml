<section class="reservation-edit">
    <?php 
        $this->headLink()->setStylesheet('/js/jquery-ui/jquery-ui.css');
        $this->headScript()->appendFile('/js/jquery-ui/jquery-ui.js');
        $this->headScript()->appendFile('/js/helper.js');      
        $form = $this->form;
        $id = $this->id;
        $model = $this->model;
        
        if(isset($id))
        {
            $form->setAttribute('action', $this->url('pms/reservation', [
                'action' => 'process',
                'id' => $id,
            ]));
            
        }
        else 
        {
            $form->setAttribute('action', $this->url('pms/reservation', [
                'action' => 'process',
            ]));            
        }
        echo $this->form()->openTag($form);        
    ?>
    <h2>Details <?php echo isset($id) ? 'Reservation ID: '. $model->reservation_id : 'New Reservation'?></h2>
    <br>
    <br>
    
    <table class="table">
        <tr>
            <td style="width:100px"><?php echo $this->formLabel($form->get('client_id'))?></td>
            <td>
                <?php echo $this->formElement($form->get('client_id'))?>
                <?php echo $this->formElementErrors($form->get('client_id'))?>
                
            </td>
        </tr>
        <tr>
            <td colspan="2"> 
                <div class="client-content">Here comes the client content.</div>
            </td>            
        </tr>
        <tr>
            <td><?php echo $this->formLabel($form->get('status_id'))?></td>
            <td>
                <?php echo $this->formElement($form->get('status_id'))?>
                <?php echo $this->formElementErrors($form->get('status_id'))?>
            </td>
        </tr>
    </table>
    <?php echo $this->formElement($form->get('created_at'))?>
    <?php echo $this->formElement($form->get('modified_at'))?>
    <h4>Reserved Entities</h4>
    <?php
        if(isset($model))
        {
            $entities = $model->getReservedEntities($id);
        }
    ?>
    <?php if(!isset($entities) || count($entities) == 0):?>
        <p class="error">There are no reserved entities associated with this reservation!
    <?php else:?>
        <table class="table">
            <tr>
                <th>Room</th>
                <th>Type</th>
                <th>Guest</th>
                <th>Start</th>
                <th>End</th>
                <th>Duration</th>
                <th>Action</th>
            </tr>
            <?php foreach($entities as $entity):?>
            <tr>
                <td><?php echo $entity->guid?></td>
                <td><?php echo $entity->ed_name?></td>
                <td><?php echo $entity->first_name. ' '.$entity->last_name; ?></td>
                <td><?php echo $entity->date_from?></td>
                <td><?php echo $entity->date_to?></td>
                <?php $duration = $entity->getDuration()?>
                <td><?php echo $duration['value'].' '. $duration['type']?></td>
                <td><a href="/pms/reservation/entity/<?php echo $entity->internal_id?>">Edit</a> | <a href="/pms/reservation/deleteEntity/<?php echo $entity->internal_id?>">Delete</a>
            </tr>
            <?php endforeach;?>
        </table>    
    <?php endif;?>    
    <p><a href="/pms/reservation/entity">Add new entity</a><br>
    <span><?php echo $this->formElement($form->get('submit'))?><a href="/pms/reservation/reset" class='ui-button'>Back</a></span>
    <?php echo $this->form()->closeTag()?>     
    <button class='ui-button' id="button1">Click me</button>
    <div id="dialog1"></div>
    <script type="text/javascript">
        $(function() {                        
            $("#button1").on("click", function(evt){
                $("#dialog1").dialog({
                    autoOpen: false,
                    modal: true
                });
                $(this).find("#dialog1").dialog("open");
            });                   
        });
        
    </script>
    
</section>

